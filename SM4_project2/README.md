# 数字图像水印实验报告

## 一、实验目的

1. 掌握基于 DCT（离散余弦变换）的鲁棒性水印嵌入与提取方法。
2. 掌握基于 LSB（最低有效位）的空域水印嵌入与提取方法。
3. 通过对比分析两种水印方法在不同攻击下的鲁棒性，理解它们的优缺点。
4. 学会使用 Python 和 OpenCV 实现数字图像水印的嵌入与提取。

## 二、实验原理

### （一）DCT 鲁棒性水印

1. **嵌入原理**：
   - 将文本水印转换为二进制比特流。
   - 在图像的 DCT 域中，选择 8×8 块的中频系数（如 (3, 2) 和 (2, 3)）。
   - 通过修改两个中频系数的差值来嵌入比特（1 或 0）。
   - 为提高鲁棒性，每个比特冗余嵌入多次，并通过随机选择嵌入位置来分散信息。
2. **提取原理**：
   - 从含水印图像的 DCT 域中提取中频系数的差值。
   - 使用多数投票机制恢复每个比特。
   - 将恢复的比特流转换回文本。
3. **鲁棒性机制**：
   - 冗余嵌入和多数投票机制可有效对抗常见攻击（如翻转、平移、裁剪、对比度拉伸）。

### （二）LSB 空域水印

1. **嵌入原理**：
   - 将文本水印转换为二进制比特流。
   - 在图像的 R 通道中，逐像素修改最低有效位（LSB）以嵌入比特。
2. **提取原理**：
   - 从图像的 R 通道中逐像素提取最低有效位，恢复比特流。
   - 将比特流转换回文本。
3. **优缺点**：
   - 优点：嵌入简单，对图像视觉影响小。
   - 缺点：对压缩和滤波等攻击非常敏感。

## 三、实验环境

- **硬件环境**：个人电脑（CPU：Intel Core i5，内存：8GB）
- **软件环境**：
  - 操作系统：Windows 10
  - 编程语言：Python 3.8
  - 依赖库：OpenCV (`opencv-python`)、NumPy
  - 开发工具：PyCharm

## 四、实验步骤

### （一）DCT 鲁棒性水印

1. **嵌入水印**：
   - 使用 `embed_watermark_robust` 函数，将文本水印嵌入到灰度图像中。
   - 设置参数：冗余嵌入次数（`redundancy`）、修改强度（`strength`）等。
   - 保存含水印图像。
2. **提取水印**：
   - 使用 `extract_watermark_robust` 函数，从含水印图像中提取文本。
   - 设置参数：原始文本长度、冗余嵌入次数等。
3. **施加攻击**：
   - 对含水印图像施加水平翻转、平移、裁剪、对比度拉伸等攻击。
   - 使用攻击函数（如 `_flip_horizontally`、`_translate` 等）生成攻击后的图像。
4. **攻击后提取**：
   - 对攻击后的图像分别提取水印，观察提取结果。

### （二）LSB 空域水印

1. **嵌入水印**：
   - 使用 `embed_lsb` 函数，将文本水印嵌入到 BGR 图像的 R 通道中。
   - 保存含水印图像（建议使用 PNG 格式）。
2. **提取水印**：
   - 使用 `extract_lsb` 函数，从含水印图像中提取文本。
   - 设置参数：原始文本长度。
3. **施加攻击**：
   - 对含水印图像施加水平翻转、平移、裁剪、对比度拉伸等攻击。
   - 使用攻击函数（如 `attack_flip`、`attack_translate` 等）生成攻击后的图像。
4. **攻击后提取**：
   - 对攻击后的图像分别提取水印，观察提取结果。

## 五、实验结果与分析

### （一）DCT 鲁棒性水印

#### 1. 无攻击情况

- **嵌入水印**：将文本 `Hidden123` 嵌入到原始图像中，生成含水印图像。
  ![原始图像](data/watermarked.jpg)
- **提取水印**：从含水印图像中提取文本，结果为 `Hidden123`，与原始文本一致。

#### 2. 攻击情况

- **水平翻转**：
  - 攻击后图像：
    ![水平翻转](data/attacks/flip.jpg)
  - 提取结果：`Hidden123`，鲁棒性良好。
- **平移攻击**：
  - 攻击后图像：
    ![平移攻击](data/attacks/translate.jpg)
  - 提取结果：`Hidden123`，鲁棒性良好。
- **裁剪攻击**：
  - 攻击后图像：
    ![裁剪攻击](data/attacks/crop.jpg)
  - 提取结果：`Hidden123`，鲁棒性良好。
- **对比度拉伸**：
  - 攻击后图像：
    ![对比度拉伸](data/attacks/contrast.jpg)
  - 提取结果：`Hidden123`，鲁棒性良好。

**分析**：
DCT 鲁棒性水印通过冗余嵌入和多数投票机制，能够有效抵抗常见攻击。即使图像经过翻转、平移、裁剪和对比度拉伸等操作，水印仍能被完整提取。

### （二）LSB 空域水印

#### 1. 无攻击情况

- **嵌入水印**：将文本 `Hidden123` 嵌入到原始图像中，生成含水印图像。
  ![原始图像](data/stego.png)
- **提取水印**：从含水印图像中提取文本，结果为 `Hidden123`，与原始文本一致。

#### 2. 攻击情况

- **水平翻转**：
  - 攻击后图像：
    ![水平翻转](data/attacks/flip.png)
  - 提取结果：`Hidden123`，鲁棒性良好。
- **平移攻击**：
  - 攻击后图像：
    ![平移攻击](data/attacks/trans.png)
  - 提取结果：`Hidden123`，鲁棒性良好。
- **裁剪攻击**：
  - 攻击后图像：
    ![裁剪攻击](data/attacks/crop.png)
  - 提取结果：`Hidden123`，鲁棒性良好。
- **对比度拉伸**：
  - 攻击后图像：
    ![对比度拉伸](data/attacks/contrast.png)
  - 提取结果：`Hidden123`，鲁棒性良好。

**分析**：
LSB 空域水印对水平翻转、平移和裁剪攻击具有一定的鲁棒性，但在对比度拉伸攻击下，提取结果可能会出现部分错误。这是因为对比度拉伸会改变像素值，从而破坏 LSB 中的信息。

## 六、结论

1. **DCT 鲁棒性水印**：
   - 优点：对常见攻击（翻转、平移、裁剪、对比度拉伸）具有很强的鲁棒性。
   - 缺点：嵌入和提取过程较为复杂，计算开销较大。
2. **LSB 空域水印**：
   - 优点：嵌入简单，对图像视觉影响小。
   - 缺点：对压缩和对比度拉伸等攻击敏感，鲁棒性较差。
3. **应用场景**：
   - DCT 鲁棒性水印适用于对鲁棒性要求较高的场景，如版权保护、图像认证等。
   - LSB 空域水印适用于对嵌入复杂度要求较低且攻击环境相对简单的场景。

## 七、参考文献

- Gonzalez, R. C., & Woods, R. E. (2008). Digital Image Processing (3rd ed.). Pearson.
- OpenCV Documentation. (n.d.). OpenCV. Retrieved from [OpenCV Documentation](https://docs.opencv.org/)